# `Konfig` - actually type-safe and highlighted Kotlin configuraton

[![Maven Central](https://img.shields.io/badge/Maven%20Central-grey)](https://search.maven.org/search?q=g:ru.potatophobe.konfig)

## Modules

- `api` - API annotations and `Konfig` container interface
- `impl` - simple API implementation and default `konfig {...}` DSL entry point
- `kts` - Kotlin Script definition allowing to describe Konfig inside `*.konfig.kts` file
- `utils` - some useful utilities
- `full` - contains all modules above
- `ksp` - Kotlin Symbol Processor generating DSL according to API annotations

## Getting started

- Configure build
```kotlin
//build.gradle.kts

plugins {
    kotlin("jvm")
    id("com.google.devtools.ksp") // Plugin to run Kotlin Symbol Processor
}

dependencies {
    implementation("ru.potatophobe.konfig:full:$konfigVersion") // Full Konfig implementation
    ksp("ru.potatophobe.konfig:ksp:$konfigVersion") // Kotlin Symbol Processor
}

kotlin {
    sourceSets.main {
        kotlin.srcDir("build/generated/ksp/main/kotlin") // There will be files generated by Kotlin Symbol Processor
    }
}
```

- Define Konfig class
```kotlin
@KonfigClass("application")
data class ApplicationKonfig(
    val name: String = "application",
    @NestedKonfig
    val property: Property,
    @NestedKonfigList
    val properties: List<Property>,
    @NestedKonfigMap
    val propertiesMap: Map<String, Property>
) {
    data class Property(
        val value: String?
    )
}
```

- Run build to generate DSL
```bash
>> gradle build
```

- Describe Konfig in `*.konfig.kts` file
```kotlin
//application.konfig.kts

application {
    property {
        value = "1"
    }
    properties {
        element {
            value = "1"
        }
        element {
            value = "2"
        }
    }
    propertiesMap {
        key("1") value {
            value = "1"
        }
        key("2") value {
            value = "2"
        }
    }
}
```

- Load Konfig from `*.konfig.kts` file
```kotlin
//main.kt

val konfigKtsFactory = KonfigKtsFactory() // Factory to load Konfig from Kotlin Script file

val konfig = konfigKtsFactory.load() // By default, 'resources/application.konfig.kts' will be loaded

val applicationKonfig = konfig.get(ApplicationKonfig::class) // ApplicationKonfig(name=application, property=Property(value=1), properties=[Property(value=1), Property(value=2)], propertiesMap={1=Property(value=1), 2=Property(value=2)})
```

- Or descriebe and get Konfig immediately in application
```kotlin
//main.kt

val konfig = konfig {
    application {
        property {
            value = "1"
        }
        properties {
            element {
                value = "1"
            }
            element {
                value = "2"
            }
        }
        propertiesMap {
            key("1") value {
                value = "1"
            }
            key("2") value {
                value = "2"
            }
        }
    }
}

val applicationKonfig = konfig.get(ApplicationKonfig::class) // ApplicationKonfig(name=application, property=Property(value=1), properties=[Property(value=1), Property(value=2)], propertiesMap={1=Property(value=1), 2=Property(value=2)})
```
